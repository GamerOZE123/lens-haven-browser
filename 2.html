import React, { useState, useEffect } from 'react';
import { Camera, Film, Mic, Tripod, Sliders, BatteryCharging, ChevronDown, CheckCircle2, X, Calendar } from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';

// Mock data for products with prices in Indian Rupees
const allProducts = [
  { id: 1, name: 'Sony Alpha 7S III', category: 'Cameras', price: '₹12,000/day', imageUrl: 'product.jpeg' },
  { id: 2, name: 'Canon EOS R5', category: 'Cameras', price: '₹14,500/day', imageUrl: 'product.jpeg' },
  { id: 3, name: 'DJI Ronin-S', category: 'Gimbals', price: '₹4,000/day', imageUrl: 'product.jpeg' },
  { id: 4, name: 'Manfrotto Carbon Tripod', category: 'Tripods', price: '₹3,200/day', imageUrl: 'product.jpeg' },
  { id: 5, name: 'Sigma 24-70mm f/2.8', category: 'Lenses', price: '₹6,400/day', imageUrl: 'product.jpeg' },
  { id: 6, name: 'DJI Mavic 3 Pro', category: 'Drones', price: '₹16,000/day', imageUrl: 'product.jpeg' },
  { id: 7, name: 'Rode NTG5', category: 'Accessories', price: '₹2,800/day', imageUrl: 'product.jpeg' },
  { id: 8, name: 'SmallRig V-Mount Battery', category: 'Accessories', price: '₹2,000/day', imageUrl: 'product.jpeg' },
  { id: 9, name: 'Tamron 70-180mm f/2.8', category: 'Lenses', price: '₹6,000/day', imageUrl: 'product.jpeg' },
  { id: 10, name: 'Zhiyun Weebill 2', category: 'Gimbals', price: '₹4,800/day', imageUrl: 'product.jpeg' },
];

// Helper component for the booking modal
const BookingModal = ({ product, onClose, onConfirm }) => {
  const [startDate, setStartDate] = useState('');
  const [endDate, setEndDate] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const today = new Date().toISOString().split('T')[0];

  const handleConfirm = () => {
    if (startDate && endDate) {
      onConfirm(product.name, startDate, endDate);
    } else {
      setErrorMessage("Please select both a start and end date.");
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    >
      <motion.div
        initial={{ scale: 0.9, y: 50 }}
        animate={{ scale: 1, y: 0 }}
        exit={{ scale: 0.9, y: 50 }}
        className="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-auto"
      >
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-xl font-bold text-gray-900">Book {product.name}</h3>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors">
            <X size={24} />
          </button>
        </div>
        
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1" htmlFor="startDate">Start Date</label>
            <input 
              type="date"
              id="startDate"
              value={startDate}
              min={today}
              onChange={(e) => {
                setStartDate(e.target.value);
                setErrorMessage('');
              }}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1" htmlFor="endDate">End Date</label>
            <input 
              type="date"
              id="endDate"
              value={endDate}
              min={startDate || today}
              onChange={(e) => {
                setEndDate(e.target.value);
                setErrorMessage('');
              }}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
            />
          </div>
        </div>

        {errorMessage && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className="mt-4 text-sm text-red-600 text-center"
          >
            {errorMessage}
          </motion.div>
        )}

        <button 
          onClick={handleConfirm}
          className="mt-6 w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-200 shadow-md"
        >
          Confirm and Book
        </button>
      </motion.div>
    </motion.div>
  );
};


// Helper component for product cards
const ProductCard = ({ product, onRentClick }) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.9 }}
    animate={{ opacity: 1, scale: 1 }}
    exit={{ opacity: 0, scale: 0.9 }}
    transition={{ duration: 0.3 }}
    className="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden"
  >
    <img src={product.imageUrl} alt={product.name} className="w-full h-48 object-cover" />
    <div className="p-4 flex flex-col justify-between">
      <div>
        <h3 className="text-lg font-semibold text-gray-900">{product.name}</h3>
        <p className="mt-1 text-sm text-gray-500">{product.category}</p>
      </div>
      <div className="mt-3 flex justify-between items-center">
        <span className="text-xl font-bold text-indigo-600">{product.price}</span>
        <button 
          onClick={() => onRentClick(product)}
          className="bg-indigo-600 text-white text-sm font-medium py-2 px-4 rounded-full hover:bg-indigo-700 transition-colors duration-200"
        >
          Rent Now
        </button>
      </div>
    </div>
  </motion.div>
);

// Main App component
const App = () => {
  const [activeFilter, setActiveFilter] = useState('All');
  const [productsToShow, setProductsToShow] = useState(allProducts);
  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);
  const [isBookingModalOpen, setIsBookingModalOpen] = useState(false);
  const [selectedProduct, setSelectedProduct] = useState(null);

  // Filter products whenever the activeFilter state changes
  useEffect(() => {
    if (activeFilter === 'All') {
      setProductsToShow(allProducts);
    } else {
      const filtered = allProducts.filter(p => p.category === activeFilter);
      setProductsToShow(filtered);
    }
  }, [activeFilter]);

  const toggleMobileNav = () => {
    setIsMobileNavOpen(!isMobileNavOpen);
  };
  
  const handleRentClick = (product) => {
    setSelectedProduct(product);
    setIsBookingModalOpen(true);
  };

  const handleBookingConfirm = (productName, startDate, endDate) => {
    const message = `Hi, I'm interested in renting the ${productName}.\nFrom date: ${startDate}\nTo date: ${endDate}\nIs it available?`;
    const whatsappUrl = `https://wa.me/9989789789?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    setIsBookingModalOpen(false);
  };
  
  const filterCategories = ['All', 'Cameras', 'Lenses', 'Tripods', 'Gimbals', 'Drones', 'Accessories'];

  return (
    <div className="min-h-screen bg-gray-100 font-inter text-gray-800">
      {/* Header */}
      <header className="bg-white sticky top-0 z-40 shadow-sm">
        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
          <div className="flex items-center">
            <Film className="h-8 w-8 text-indigo-600 mr-2" />
            <h1 className="text-2xl font-bold text-gray-900">CamRent</h1>
          </div>
          <nav className="hidden md:flex space-x-6 font-medium">
            <a href="#products" className="text-gray-600 hover:text-indigo-600 transition-colors">Products</a>
            <a href="#contact" className="text-gray-600 hover:text-indigo-600 transition-colors">Contact</a>
          </nav>
          <button onClick={toggleMobileNav} className="md:hidden p-2 rounded-md hover:bg-gray-100 transition-colors">
            {isMobileNavOpen ? <X size={24} /> : <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>}
          </button>
        </div>
        <AnimatePresence>
          {isMobileNavOpen && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
              className="md:hidden bg-white shadow-md absolute w-full"
            >
              <div className="flex flex-col items-center py-4 space-y-4">
                <a href="#products" className="text-gray-800 hover:text-indigo-600 transition-colors" onClick={toggleMobileNav}>Products</a>
                <a href="#contact" className="text-gray-800 hover:text-indigo-600 transition-colors" onClick={toggleMobileNav}>Contact</a>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </header>

      {/* Main Content */}
      <main>
        {/* Hero Section */}
        <section className="relative h-[50vh] flex items-center justify-center text-white text-center">
            <div className="absolute inset-0 bg-cover bg-center" style={{ backgroundImage: 'url(banner.jpeg)' }}></div>
            <div className="absolute inset-0 bg-black opacity-60"></div>
            <div className="container mx-auto px-4 relative z-10">
                <h2 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight">
                    Rent Professional Camera Gear
                </h2>
                <p className="mt-4 text-lg sm:text-xl font-light max-w-2xl mx-auto">
                    High-quality equipment for every project, from filmmaking to photography.
                </p>
                <a href="#products" className="mt-8 inline-block bg-white text-indigo-600 font-bold text-lg py-3 px-8 rounded-full shadow-lg hover:bg-gray-100 transition-colors duration-300 transform hover:scale-105">
                    Explore Our Gear
                </a>
            </div>
        </section>

        {/* Products Section */}
        <section id="products" className="container mx-auto px-4 py-12">
          <h2 className="text-3xl font-bold text-center mb-8">Our Equipment</h2>

          {/* Filter Bar for Desktop */}
          <div className="hidden md:flex justify-center space-x-2 mb-8">
            {filterCategories.map(category => (
              <button
                key={category}
                onClick={() => setActiveFilter(category)}
                className={`py-2 px-5 rounded-full font-medium transition-colors duration-200
                  ${activeFilter === category ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}
              >
                {category}
              </button>
            ))}
          </div>

          {/* Filter Dropdown for Mobile */}
          <div className="md:hidden mb-8 relative">
            <div className="relative">
              <select
                onChange={(e) => setActiveFilter(e.target.value)}
                value={activeFilter}
                className="block w-full py-3 px-4 pr-10 border border-gray-300 rounded-lg appearance-none bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              >
                {filterCategories.map(category => (
                  <option key={category} value={category}>{category}</option>
                ))}
              </select>
              <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                <ChevronDown size={20} />
              </div>
            </div>
          </div>

          {/* Product Grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <AnimatePresence>
              {productsToShow.map(product => (
                <ProductCard key={product.id} product={product} onRentClick={handleRentClick} />
              ))}
            </AnimatePresence>
          </div>
        </section>
      </main>

      {/* Footer */}
      <footer className="bg-gray-800 text-gray-300 py-8">
        <div className="container mx-auto px-4 text-center">
          <p>&copy; 2024 CamRent. All rights reserved.</p>
        </div>
      </footer>

      {/* Booking Modal */}
      <AnimatePresence>
        {isBookingModalOpen && selectedProduct && (
          <BookingModal
            product={selectedProduct}
            onClose={() => setIsBookingModalOpen(false)}
            onConfirm={handleBookingConfirm}
          />
        )}
      </AnimatePresence>
    </div>
  );
};

export default App;
